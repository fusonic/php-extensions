phpunit:ddd-extensions:symfony:
    extends: .phpunit-test
    needs: []
    variables:
        PACKAGE: ddd-extensions
    only:
        changes:
            - packages/ddd-extensions/**/*
    script:
        - composer phpstan
        - composer phpcs-check
        - vendor/bin/phpunit --coverage-text --coverage-cobertura=coverage/cobertura.xml --coverage-html=coverage/html

phpunit:ddd-extensions:symfony-lowest:
    extends: .phpunit-test
    needs: []
    variables:
        PACKAGE: ddd-extensions
        PHP_VERSION: '8.0'
    environment:
        name: coverage/${PACKAGE}-symfony-lowest/${CI_COMMIT_REF_NAME}
    only:
        changes:
            - packages/ddd-extensions/**/*
    script:
        - composer update --prefer-lowest --prefer-stable --no-progress --no-suggest --no-interaction
        - vendor/bin/phpunit

ddd-extensions:publish-master:
    extends: .publish-master
    needs: []
    variables:
        PACKAGE: ddd-extensions
        REPOSITORY: git@github.com:fusonic/php-ddd-extensions.git
    only:
        changes:
            - packages/ddd-extensions/**/*

ddd-extensions:publish-tag:
    extends: .publish-tag
    needs: []
    variables:
        PACKAGE: ddd-extensions
        REPOSITORY: git@github.com:fusonic/php-ddd-extensions.git
    only:
        changes:
            - packages/ddd-extensions/**/*
